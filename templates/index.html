<!DOCTYPE html>
<html lang="en">
<head>
	<title>{{user.system_name}}</title>
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<header>
		<h1>{{ user.system_name }}</h1>
		<nav class="nav-bar">
			<ul class="nav-list">
				<li class="nav-list-item">
					<a class="nav-link selected" href="/clear_chat">Home</a>
				</li>
				<li class="nav-list-item">
					<a class="nav-link" href="/preferences">Preferences</a>
				</li>
				<li class="nav-list-item">
					<a class="nav-link" href="/history">History</a>
				</li>
				<li class="nav-list-item">
					<a class="nav-link" href="/insights">Insights</a>
				</li>
			</ul>
		</nav>
	</header>

	<main>
		<div class="sidebar">
			<section class="display">
				{% if display %}
					{{ display }}
				{% else %}
					ðŸ˜€
				{% endif %}
			</section>
			{% if user %}
				<div class="user-info">
					<p>Welcome {{ user.name }}!</p>
				</div>
			{% endif %}
			
			{% if history %}
			  <section class="history-section">
				<h3>History</h3>
				<ul class="history-list">
					{% for transcript in history %}
						<li class="transcript-item">
							<a href="{{ url_for('subject', subject=transcript[1]) }}">
								<div class="history-subject">{{ transcript[1] }}</div>
							</a>
							<form action="{{ url_for('delete_transcript') }}" method="post">
								<input type="hidden" name="subject" value="{{ transcript[1] }}">
								<button type="submit" class="delete-button">x</button>
							</form>
						</li>
					{% endfor %}
				</ul>
			  </section>
			{% else %}
			  <section class="history-section">
				<p class="no-history-msg">No History Found</p>
			  </section>
			{% endif %}
		</div>

		<div class="primary-container">
			<section class="chat-section">
				{% if chat_transcript %}
				<div class="chat-container">
					{% for exchange in chat_transcript %}
						<div class="chat-window" id="chat-window-{{ loop.index }}">
							<div class="chat-message user">
								<div class="avi-container">
									<img class="user-avi" src="/static/assets/icons/user.svg" alt="user avatar">
								</div>
								<p class="user-message">
									<span>{{user.name}}:</span>{{ exchange.user_message }}
								</p>
							</div>

							<div class="chat-message assist">
								<div class="avi-container">
									<img class="user-avi" src="/static/assets/icons/assist.svg" alt="assistant avatar">
								</div>
								<p class="assistant-message">
									<span>{{user.system_name}}:</span>{{ exchange.assistant_message }}
									<button class="copy" onclick="copyText(this)">
										<img class="copy-icon" src="/static/assets/icons/content_copy.svg" alt="copy icon">
									</button>
									<span class="copy-feedback">Message copied</span>
								</p>
							</div>
						</div>
					{% endfor %}
				</div>
				{% endif %}
			</section>
			
			<section class="chat-input-section">
				<form id="chat-form" method="post" enctype="multipart/form-data">
					<textarea class="chat-input" cols="30" rows="3" type="text" id="text" name="text" placeholder="Enter your message..."></textarea>	
					<div class="button-container">
						<button id="submitButton" type="submit">Submit</button>
						<button id="recordButton">Record</button>
					</div>
				</form>
			</section>
		</div>
	</main>
	<script>
		const chatContainer = document.querySelector('.chat-container');
		chatContainer.scrollTop = chatContainer.scrollHeight;
	</script>
	<script src="/static/js/recorder.js"></script>
	<script src="/static/js/copyPaste.js"></script>
	<script src="/static/js/scrollToBottom.js"></script>
</body>
</html>
